#!/usr/bin/env ruby
# Requires Ruby 1.9+
$:.unshift(File.join(File.dirname(__FILE__), '..', 'lib'))

require 'thor'
require 'chef-server-test/config'

class ValidateCLI < Thor
  desc 'reset', 'resets tests'
  def reset
    ChefServerTest::Tasks::Reset.execute!
  end

  option :'upgrade-from'
  desc 'all [CANDIDATE PKG]', 'runs all tests'
  def all(candidate_pkg_path)
    require 'chef-server-test/tests/all'
    ChefServerTest::Tests::All.
      new(candidate_pkg_path: candidate_pkg_path,
          upgrade_from:       options[:'upgrade-from']).
      execute!
  end

  desc 'install [CANDIDATE PKG]', 'runs install test'
  def install(candidate_pkg_path)
    require 'chef-server-test/tests/install'
    ChefServerTest::Tests::Install.
      new(candidate_pkg_path: candidate_pkg_path).
      execute!
  end

  option :'upgrade-from'
  desc 'upgrade [CANDIDATE PKG]', 'runs upgrade test'
  def upgrade(candidate_pkg_path)
    require 'chef-server-test/tests/upgrade'
    ChefServerTest::Tests::Upgrade.
      new(candidate_pkg_path: candidate_pkg_path,
          upgrade_from:       options[:'upgrade-from']).
      execute!
  end

  desc 'converge [CANDIDATE PKG]', 'runs converge test'
  def converge(candidate_pkg_path)
    require 'chef-server-test/tests/converge'
    ChefServerTest::Tests::Converge.
      new(candidate_pkg_path: candidate_pkg_path).
      execute!
  end


end

ValidateCLI.start(ARGV)
